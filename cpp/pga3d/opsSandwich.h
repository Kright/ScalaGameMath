// Copyright (c) 2025 Igor Slobodskov
// SPDX-License-Identifier: MIT

#pragma once

#include "types.h"

// generated by com.github.kright.pga3d.codegen.cpp.ops.SandwichOpGenerator

/**
 * Compiler can reuse constants between calls, where the same object used several times,
 * So in the code below all that constants `const double sMs = s * s` are reused and the code is fast.
 * It is crucial to keep method constexpr or inline to achieve this
 * On my machine this trick speed up `Motor.sandwich(Bivector)` from 9 ns to 3 ns
 * @code
 * const pga3d::Motor& motor = ...
 * for(pga3d::Vector& v: array) {
 *     v = motor.sandwich(v);
 * }
 * @endcode
 */
namespace pga3d {
    constexpr Multivector Multivector::sandwich(const Multivector& b) const noexcept {
        const double sMs = s * s;
        const double sMw = s * w;
        const double sMx = s * x;
        const double sMy = s * y;
        const double sMz = s * z;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double sMwxy = s * wxy;
        const double sMwxz = s * wxz;
        const double sMwyz = s * wyz;
        const double sMxyz = s * xyz;
        const double sMi = i * s;
        const double wMx = w * x;
        const double wMy = w * y;
        const double wMz = w * z;
        const double wMxy = w * xy;
        const double wMxz = w * xz;
        const double wMyz = w * yz;
        const double wMxyz = w * xyz;
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double xMwx = wx * x;
        const double xMwy = wy * x;
        const double xMwz = wz * x;
        const double xMxy = x * xy;
        const double xMxz = x * xz;
        const double xMyz = x * yz;
        const double xMwxy = wxy * x;
        const double xMwxz = wxz * x;
        const double xMwyz = wyz * x;
        const double xMxyz = x * xyz;
        const double xMi = i * x;
        const double yMy = y * y;
        const double yMz = y * z;
        const double yMwx = wx * y;
        const double yMwy = wy * y;
        const double yMwz = wz * y;
        const double yMxy = xy * y;
        const double yMxz = xz * y;
        const double yMyz = y * yz;
        const double yMwxy = wxy * y;
        const double yMwxz = wxz * y;
        const double yMwyz = wyz * y;
        const double yMxyz = xyz * y;
        const double yMi = i * y;
        const double zMz = z * z;
        const double zMwx = wx * z;
        const double zMwy = wy * z;
        const double zMwz = wz * z;
        const double zMxy = xy * z;
        const double zMxz = xz * z;
        const double zMyz = yz * z;
        const double zMwxy = wxy * z;
        const double zMwxz = wxz * z;
        const double zMwyz = wyz * z;
        const double zMxyz = xyz * z;
        const double zMi = i * z;
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wxMxyz = wx * xyz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wyMxyz = wy * xyz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double wzMxyz = wz * xyz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xyMwxy = wxy * xy;
        const double xyMwxz = wxz * xy;
        const double xyMwyz = wyz * xy;
        const double xyMxyz = xy * xyz;
        const double xyMi = i * xy;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double xzMwxy = wxy * xz;
        const double xzMwxz = wxz * xz;
        const double xzMwyz = wyz * xz;
        const double xzMxyz = xyz * xz;
        const double xzMi = i * xz;
        const double yzMyz = yz * yz;
        const double yzMwxy = wxy * yz;
        const double yzMwxz = wxz * yz;
        const double yzMwyz = wyz * yz;
        const double yzMxyz = xyz * yz;
        const double yzMi = i * yz;
        const double wxyMxyz = wxy * xyz;
        const double wxzMxyz = wxz * xyz;
        const double wyzMxyz = wyz * xyz;
        const double xyzMxyz = xyz * xyz;
        const double xyzMi = i * xyz;
        return {
            .s = (2.0 * (b.x * (sMx + yzMxyz - yMxy - zMxz) + b.y * (sMy + xMxy - xzMxyz - zMyz) + b.z * (sMz + xMxz + xyMxyz + yMyz)) + b.s * (sMs + xMx + xyMxy + xyzMxyz + xzMxz + yMy + yzMyz + zMz)),
            .w = (2.0 * (b.i * (sMxyz + yMxz - xMyz - zMxy) + b.s * (sMw + xMwx + xyMwxy + xyzMi + xzMwxz + yMwy + yzMwyz + zMwz) + b.x * (sMwx + wMx + wyzMxyz + yzMi - wyMxy - wzMxz - yMwxy - zMwxz) + b.y * (sMwy + wMy + wxMxy + xMwxy - wxzMxyz - wzMyz - xzMi - zMwyz) + b.z * (sMwz + wMz + wxMxz + wxyMxyz + wyMyz + xMwxz + xyMi + yMwyz)) + b.w * (sMs + xyMxy + xzMxz + yzMyz - xMx - xyzMxyz - yMy - zMz)),
            .x = (2.0 * (b.s * (sMx + yMxy + yzMxyz + zMxz) + b.y * (sMxy + xMy - xzMyz - zMxyz) + b.z * (sMxz + xMz + xyMyz + yMxyz)) + b.x * (sMs + xMx + xyzMxyz + yzMyz - xyMxy - xzMxz - yMy - zMz)),
            .y = (2.0 * (b.s * (sMy + zMyz - xMxy - xzMxyz) + b.x * (xMy + zMxyz - sMxy - xzMyz) + b.z * (sMyz + yMz - xMxyz - xyMxz)) + b.y * (sMs + xyzMxyz + xzMxz + yMy - xMx - xyMxy - yzMyz - zMz)),
            .z = (2.0 * (b.s * (sMz + xyMxyz - xMxz - yMyz) + b.x * (xMz + xyMyz - sMxz - yMxyz) + b.y * (xMxyz + yMz - sMyz - xyMxz)) + b.z * (sMs + xyMxy + xyzMxyz + zMz - xMx - xzMxz - yMy - yzMyz)),
            .wx = (2.0 * (b.wxy * (sMy + xzMxyz - xMxy - zMyz) + b.wxz * (sMz + yMyz - xMxz - xyMxyz) + b.wy * (sMxy + zMxyz - xMy - xzMyz) + b.wyz * (sMxyz + zMxy - xMyz - yMxz) + b.wz * (sMxz + xyMyz - xMz - yMxyz) + b.xy * (wMy + wxMxy + wxzMxyz + wzMyz - sMwy - xMwxy - xzMi - zMwyz) + b.xyz * (wMyz + wxMxyz + xyMwxz + yMwz - sMwyz - xMi - xzMwxy - zMwy) + b.xz * (wMz + wxMxz + xyMi + yMwyz - sMwz - wxyMxyz - wyMyz - xMwxz) + b.yz * (wMxyz + wxMyz + wyMxz + zMwxy - sMi - wzMxy - xMwyz - yMwxz)) + b.wx * (sMs + yMy + yzMyz + zMz - xMx - xyMxy - xyzMxyz - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xMy - xzMyz - zMxyz) + b.wxy * (yzMxyz + zMxz - sMx - yMxy) + b.wxz * (-sMxyz - xMyz - yMxz - zMxy) + b.wyz * (sMz + xMxz - xyMxyz - yMyz) + b.wz * (sMyz + xMxyz - xyMxz - yMz) + b.xy * (sMwx + wyMxy + wyzMxyz + zMwxz - wMx - wzMxz - yMwxy - yzMi) + b.xyz * (sMwxz + wyMxyz + xyMwyz + zMwx - wMxz - xMwz - yMi - yzMwxy) + b.xz * (sMi + wxMyz + wyMxz + wzMxy - wMxyz - xMwyz - yMwxz - zMwxy) + b.yz * (wMz + wyMyz + xMwxz + xyMi - sMwz - wxMxz - wxyMxyz - yMwyz)) + b.wy * (sMs + xMx + xzMxz + zMz - xyMxy - xyzMxyz - yMy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz + yMxyz - sMxz - xMz) + b.wxy * (sMxyz + xMyz - yMxz - zMxy) + b.wxz * (yMxy + yzMxyz - sMx - zMxz) + b.wy * (-sMyz - xMxyz - xyMxz - yMz) + b.wyz * (-sMy - xMxy - xzMxyz - zMyz) + b.xy * (wMxyz + wyMxz + wzMxy + xMwyz - sMi - wxMyz - yMwxz - zMwxy) + b.xyz * (wMxy + wzMxyz + xMwy + xzMwyz - sMwxy - yMwx - yzMwxz - zMi) + b.xz * (sMwx + wyzMxyz + wzMxz + yMwxy - wMx - wyMxy - yzMi - zMwxz) + b.yz * (sMwy + wxMxy + wzMyz + xzMi - wMy - wxzMxyz - xMwxy - zMwyz)) + b.wz * (sMs + xMx + xyMxy + yMy - xyzMxyz - xzMxz - yzMyz - zMz)),
            .xy = (2.0 * (b.xyz * (sMz + xyMxyz - xMxz - yMyz) + b.xz * (sMyz + xyMxz - xMxyz - yMz) + b.yz * (xMz + xyMyz - sMxz - yMxyz)) + b.xy * (sMs + xyMxy + xyzMxyz + zMz - xMx - xzMxz - yMy - yzMyz)),
            .xz = (2.0 * (b.xy * (xMxyz + xyMxz - sMyz - yMz) + b.xyz * (xMxy + xzMxyz - sMy - zMyz) + b.yz * (sMxy + xzMyz - xMy - zMxyz)) + b.xz * (sMs + xyzMxyz + xzMxz + yMy - xMx - xyMxy - yzMyz - zMz)),
            .yz = (2.0 * (b.xy * (sMxz + xMz + xyMyz + yMxyz) + b.xyz * (sMx + yMxy + yzMxyz + zMxz) + b.xz * (xzMyz + zMxyz - sMxy - xMy)) + b.yz * (sMs + xMx + xyzMxyz + yzMyz - xyMxy - xzMxz - yMy - zMz)),
            .wxy = (2.0 * (b.wx * (sMy + xMxy + xzMxyz + zMyz) + b.wxz * (sMyz + xMxyz + xyMxz + yMz) + b.wy * (yMxy + yzMxyz - sMx - zMxz) + b.wyz * (xyMyz + yMxyz - sMxz - xMz) + b.wz * (yMxz + zMxy - sMxyz - xMyz) + b.xy * (sMw + xyMwxy + xyzMi + zMwz - xMwx - xzMwxz - yMwy - yzMwyz) + b.xyz * (sMwz + wMz + wxyMxyz + xyMi - wxMxz - wyMyz - xMwxz - yMwyz) + b.xz * (sMwyz + wMyz + xyMwxz + xzMwxy - wxMxyz - xMi - yMwz - zMwy) + b.yz * (xMwz + xyMwyz + yzMwxy + zMwx - sMwxz - wMxz - wyMxyz - yMi)) + b.wxy * (sMs + xMx + xyMxy + yMy - xyzMxyz - xzMxz - yzMyz - zMz)),
            .wxz = (2.0 * (b.wx * (sMz + xMxz - xyMxyz - yMyz) + b.wxy * (xyMxz + yMz - sMyz - xMxyz) + b.wy * (sMxyz + xMyz + yMxz + zMxy) + b.wyz * (sMxy + xMy + xzMyz + zMxyz) + b.wz * (yzMxyz + zMxz - sMx - yMxy) + b.xy * (wxMxyz + xMi + xyMwxz + xzMwxy - sMwyz - wMyz - yMwz - zMwy) + b.xyz * (wxMxy + wxzMxyz + xMwxy + xzMi - sMwy - wMy - wzMyz - zMwyz) + b.xz * (sMw + xyzMi + xzMwxz + yMwy - xMwx - xyMwxy - yzMwyz - zMwz) + b.yz * (sMwxy + wMxy + xzMwyz + yzMwxz - wzMxyz - xMwy - yMwx - zMi)) + b.wxz * (sMs + xMx + xzMxz + zMz - xyMxy - xyzMxyz - yMy - yzMyz)),
            .wyz = (2.0 * (b.wx * (xMyz + yMxz - sMxyz - zMxy) + b.wxy * (sMxz + xyMyz - xMz - yMxyz) + b.wxz * (xMy + xzMyz - sMxy - zMxyz) + b.wy * (sMz + yMyz - xMxz - xyMxyz) + b.wz * (xMxy + zMyz - sMy - xzMxyz) + b.xy * (sMwxz + wMxz + wyMxyz + xMwz + xyMwyz + yMi + yzMwxy + zMwx) + b.xyz * (sMwx + wMx + wyMxy + wyzMxyz + wzMxz + yMwxy + yzMi + zMwxz) + b.xz * (wzMxyz + xzMwyz + yzMwxz + zMi - sMwxy - wMxy - xMwy - yMwx) + b.yz * (sMw + xMwx + xyzMi + yzMwyz - xyMwxy - xzMwxz - yMwy - zMwz)) + b.wyz * (sMs + yMy + yzMyz + zMz - xMx - xyMxy - xyzMxyz - xzMxz)),
            .xyz = (2.0 * (b.xy * (sMz + xMxz + xyMxyz + yMyz) + b.xz * (xzMxyz + zMyz - sMy - xMxy) + b.yz * (sMx + yzMxyz - yMxy - zMxz)) + b.xyz * (sMs + xMx + xyMxy + xyzMxyz + xzMxz + yMy + yzMyz + zMz)),
            .i = (2.0 * (b.s * (sMi + wyMxz + xMwyz + zMwxy - wMxyz - wxMyz - wzMxy - yMwxz) + b.w * (xMyz + zMxy - sMxyz - yMxz) + b.x * (sMwyz + xMi + xyMwxz + yMwz - wMyz - wxMxyz - xzMwxy - zMwy) + b.y * (wMxz + xyMwyz + yMi + zMwx - sMwxz - wyMxyz - xMwz - yzMwxy) + b.z * (sMwxy + xMwy + xzMwyz + zMi - wMxy - wzMxyz - yMwx - yzMwxz)) + b.i * (sMs + xyMxy + xzMxz + yzMyz - xMx - xyzMxyz - yMy - zMz))
        };
    }


    constexpr Motor Motor::sandwich(const Motor& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double sMi = i * s;
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xyMi = i * xy;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double xzMi = i * xz;
        const double yzMyz = yz * yz;
        const double yzMi = i * yz;
        return {
            .s = b.s * (sMs + xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz) + b.xy * (wxMxy + wzMyz - sMwy - xzMi) + b.xz * (wxMxz + xyMi - sMwz - wyMyz) + b.yz * (wxMyz + wyMxz - sMi - wzMxy)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz) + b.xy * (sMwx + wyMxy - wzMxz - yzMi) + b.xz * (sMi + wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz + xyMi - sMwz - wxMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz) + b.xy * (wyMxz + wzMxy - sMi - wxMyz) + b.xz * (sMwx + wzMxz - wyMxy - yzMi) + b.yz * (sMwy + wxMxy + wzMyz + xzMi)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz)),
            .i = (b.i * (sMs + xyMxy + xzMxz + yzMyz) + 2.0 * b.s * (sMi + wyMxz - wxMyz - wzMxy))
        };
    }

    constexpr Plane Motor::sandwich(const Plane& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = (2.0 * (b.x * (i * yz + s * wx - wy * xy - wz * xz) + b.y * (s * wy + wx * xy - i * xz - wz * yz) + b.z * (i * xy + s * wz + wx * xz + wy * yz)) + b.w * (sMs + xyMxy + xzMxz + yzMyz))
        };
    }

    constexpr Bivector Motor::sandwich(const Bivector& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double sMi = i * s;
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xyMi = i * xy;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double xzMi = i * xz;
        const double yzMyz = yz * yz;
        const double yzMi = i * yz;
        return {
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz) + b.xy * (wxMxy + wzMyz - sMwy - xzMi) + b.xz * (wxMxz + xyMi - sMwz - wyMyz) + b.yz * (wxMyz + wyMxz - sMi - wzMxy)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz) + b.xy * (sMwx + wyMxy - wzMxz - yzMi) + b.xz * (sMi + wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz + xyMi - sMwz - wxMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz) + b.xy * (wyMxz + wzMxy - sMi - wxMyz) + b.xz * (sMwx + wzMxz - wyMxy - yzMi) + b.yz * (sMwy + wxMxy + wzMyz + xzMi)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr ProjectivePoint Motor::sandwich(const ProjectivePoint& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.w * (-i * yz - s * wx - wy * xy - wz * xz) + b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.w * (i * xz + wx * xy - s * wy - wz * yz) + b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.w * (wx * xz + wy * yz - i * xy - s * wz) + b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = b.w * (sMs + xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Motor Motor::sandwich(const Quaternion& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double sMi = i * s;
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xyMi = i * xy;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double xzMi = i * xz;
        const double yzMyz = yz * yz;
        const double yzMi = i * yz;
        return {
            .s = b.s * (sMs + xyMxy + xzMxz + yzMyz),
            .wx = 2.0 * (b.xy * (wxMxy + wzMyz - sMwy - xzMi) + b.xz * (wxMxz + xyMi - sMwz - wyMyz) + b.yz * (wxMyz + wyMxz - sMi - wzMxy)),
            .wy = 2.0 * (b.xy * (sMwx + wyMxy - wzMxz - yzMi) + b.xz * (sMi + wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz + xyMi - sMwz - wxMxz)),
            .wz = 2.0 * (b.xy * (wyMxz + wzMxy - sMi - wxMyz) + b.xz * (sMwx + wzMxz - wyMxy - yzMi) + b.yz * (sMwy + wxMxy + wzMyz + xzMi)),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz)),
            .i = 2.0 * b.s * (sMi + wyMxz - wxMyz - wzMxy)
        };
    }

    constexpr Motor Motor::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (sMs + xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz)),
            .xy = 0.0,
            .xz = 0.0,
            .yz = 0.0,
            .i = 2.0 * b.s * (i * s + wy * xz - wx * yz - wz * xy)
        };
    }

    constexpr Motor Motor::sandwich(const Translator& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = (sMs + xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz)),
            .xy = 0.0,
            .xz = 0.0,
            .yz = 0.0,
            .i = 2.0 * (i * s + wy * xz - wx * yz - wz * xy)
        };
    }

    constexpr Vector Motor::sandwich(const Vector& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr ProjectivePoint Motor::sandwich(const Point& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz) - i * yz - s * wx - wy * xy - wz * xz) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz) + i * xz + wx * xy - s * wy - wz * yz) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz) + wx * xz + wy * yz - i * xy - s * wz) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = (sMs + xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Plane Motor::sandwich(const PlaneIdeal& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = 2.0 * (b.x * (i * yz + s * wx - wy * xy - wz * xz) + b.y * (s * wy + wx * xy - i * xz - wz * yz) + b.z * (i * xy + s * wz + wx * xz + wy * yz))
        };
    }

    constexpr Bivector Motor::sandwich(const BivectorBulk& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double sMi = i * s;
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xyMi = i * xy;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double xzMi = i * xz;
        const double yzMyz = yz * yz;
        const double yzMi = i * yz;
        return {
            .wx = 2.0 * (b.xy * (wxMxy + wzMyz - sMwy - xzMi) + b.xz * (wxMxz + xyMi - sMwz - wyMyz) + b.yz * (wxMyz + wyMxz - sMi - wzMxy)),
            .wy = 2.0 * (b.xy * (sMwx + wyMxy - wzMxz - yzMi) + b.xz * (sMi + wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz + xyMi - sMwz - wxMxz)),
            .wz = 2.0 * (b.xy * (wyMxz + wzMxy - sMi - wxMyz) + b.xz * (sMwx + wzMxz - wyMxy - yzMi) + b.yz * (sMwy + wxMxy + wzMyz + xzMi)),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr BivectorWeight Motor::sandwich(const BivectorWeight& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr PseudoScalar Motor::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * (s * s + xy * xy + xz * xz + yz * yz)
        };
    }

    constexpr ProjectivePoint Motor::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 2.0 * (-i * yz - s * wx - wy * xy - wz * xz),
            .y = 2.0 * (i * xz + wx * xy - s * wy - wz * yz),
            .z = 2.0 * (wx * xz + wy * yz - i * xy - s * wz),
            .w = (s * s + xy * xy + xz * xz + yz * yz)
        };
    }


    constexpr Motor Plane::sandwich(const Motor& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double xMw = w * x;
        const double yMy = y * y;
        const double yMz = y * z;
        const double yMw = w * y;
        const double zMz = z * z;
        const double zMw = w * z;
        return {
            .s = b.s * (xMx + yMy + zMz),
            .wx = (2.0 * (b.xy * yMw + b.xz * zMw - b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (b.yz * zMw - b.wx * xMy - b.wz * yMz - b.xy * xMw) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz - b.xz * xMw - b.yz * yMw) + b.wz * (xMx + yMy - zMz)),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz)),
            .i = b.i * (-xMx - yMy - zMz)
        };
    }

    constexpr Plane Plane::sandwich(const Plane& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (b.y * xMy + b.z * xMz) + b.x * (xMx - yMy - zMz)),
            .y = (2.0 * (b.x * xMy + b.z * yMz) + b.y * (yMy - xMx - zMz)),
            .z = (2.0 * (b.x * xMz + b.y * yMz) + b.z * (zMz - xMx - yMy)),
            .w = (b.w * (-xMx - yMy - zMz) + 2.0 * w * (b.x * x + b.y * y + b.z * z))
        };
    }

    constexpr Bivector Plane::sandwich(const Bivector& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double xMw = w * x;
        const double yMy = y * y;
        const double yMz = y * z;
        const double yMw = w * y;
        const double zMz = z * z;
        const double zMw = w * z;
        return {
            .wx = (2.0 * (b.xy * yMw + b.xz * zMw - b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (b.yz * zMw - b.wx * xMy - b.wz * yMz - b.xy * xMw) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz - b.xz * xMw - b.yz * yMw) + b.wz * (xMx + yMy - zMz)),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz))
        };
    }

    constexpr ProjectivePoint Plane::sandwich(const ProjectivePoint& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (-b.y * xMy - b.z * xMz - b.w * w * x) + b.x * (yMy + zMz - xMx)),
            .y = (2.0 * (-b.x * xMy - b.z * yMz - b.w * w * y) + b.y * (xMx + zMz - yMy)),
            .z = (2.0 * (-b.x * xMz - b.y * yMz - b.w * w * z) + b.z * (xMx + yMy - zMz)),
            .w = b.w * (xMx + yMy + zMz)
        };
    }

    constexpr Motor Plane::sandwich(const Quaternion& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double xMw = w * x;
        const double yMy = y * y;
        const double yMz = y * z;
        const double yMw = w * y;
        const double zMz = z * z;
        const double zMw = w * z;
        return {
            .s = b.s * (xMx + yMy + zMz),
            .wx = 2.0 * (b.xy * yMw + b.xz * zMw),
            .wy = 2.0 * (b.yz * zMw - b.xy * xMw),
            .wz = 2.0 * (-b.xz * xMw - b.yz * yMw),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz)),
            .i = 0.0
        };
    }

    constexpr ProjectiveTranslator Plane::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .s = b.s * (xMx + yMy + zMz),
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz))
        };
    }

    constexpr ProjectiveTranslator Plane::sandwich(const Translator& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .s = (xMx + yMy + zMz),
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz))
        };
    }

    constexpr Vector Plane::sandwich(const Vector& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (-b.y * xMy - b.z * xMz) + b.x * (yMy + zMz - xMx)),
            .y = (2.0 * (-b.x * xMy - b.z * yMz) + b.y * (xMx + zMz - yMy)),
            .z = (2.0 * (-b.x * xMz - b.y * yMz) + b.z * (xMx + yMy - zMz))
        };
    }

    constexpr ProjectivePoint Plane::sandwich(const Point& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (-b.y * xMy - b.z * xMz - w * x) + b.x * (yMy + zMz - xMx)),
            .y = (2.0 * (-b.x * xMy - b.z * yMz - w * y) + b.y * (xMx + zMz - yMy)),
            .z = (2.0 * (-b.x * xMz - b.y * yMz - w * z) + b.z * (xMx + yMy - zMz)),
            .w = (xMx + yMy + zMz)
        };
    }

    constexpr Plane Plane::sandwich(const PlaneIdeal& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (b.y * xMy + b.z * xMz) + b.x * (xMx - yMy - zMz)),
            .y = (2.0 * (b.x * xMy + b.z * yMz) + b.y * (yMy - xMx - zMz)),
            .z = (2.0 * (b.x * xMz + b.y * yMz) + b.z * (zMz - xMx - yMy)),
            .w = 2.0 * w * (b.x * x + b.y * y + b.z * z)
        };
    }

    constexpr Bivector Plane::sandwich(const BivectorBulk& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double xMw = w * x;
        const double yMy = y * y;
        const double yMz = y * z;
        const double yMw = w * y;
        const double zMz = z * z;
        const double zMw = w * z;
        return {
            .wx = 2.0 * (b.xy * yMw + b.xz * zMw),
            .wy = 2.0 * (b.yz * zMw - b.xy * xMw),
            .wz = 2.0 * (-b.xz * xMw - b.yz * yMw),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz))
        };
    }

    constexpr BivectorWeight Plane::sandwich(const BivectorWeight& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz))
        };
    }

    constexpr PseudoScalar Plane::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * (-x * x - y * y - z * z)
        };
    }

    constexpr ProjectivePoint Plane::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = -2.0 * w * x,
            .y = -2.0 * w * y,
            .z = -2.0 * w * z,
            .w = (x * x + y * y + z * z)
        };
    }


    constexpr Motor Bivector::sandwich(const Motor& b) const noexcept {
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wz * xyMyz + b.xy * (wxMxy + wzMyz) + b.xz * (wxMxz - wyMyz) + b.yz * (wxMyz + wyMxz - wzMxy) - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.xy * (wyMxy - wzMxz) + b.xz * (wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz - wxMxz) - b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz + b.xy * (wyMxz + wzMxy - wxMyz) + b.xz * (wzMxz - wyMxy) + b.yz * (wxMxy + wzMyz) - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz)),
            .i = (b.i * (xyMxy + xzMxz + yzMyz) + 2.0 * b.s * (wyMxz - wxMyz - wzMxy))
        };
    }

    constexpr Plane Bivector::sandwich(const Plane& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = (2.0 * (b.x * (-wy * xy - wz * xz) + b.y * (wx * xy - wz * yz) + b.z * (wx * xz + wy * yz)) + b.w * (xyMxy + xzMxz + yzMyz))
        };
    }

    constexpr Bivector Bivector::sandwich(const Bivector& b) const noexcept {
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wz * xyMyz + b.xy * (wxMxy + wzMyz) + b.xz * (wxMxz - wyMyz) + b.yz * (wxMyz + wyMxz - wzMxy) - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.xy * (wyMxy - wzMxz) + b.xz * (wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz - wxMxz) - b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz + b.xy * (wyMxz + wzMxy - wxMyz) + b.xz * (wzMxz - wyMxy) + b.yz * (wxMxy + wzMyz) - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr ProjectivePoint Bivector::sandwich(const ProjectivePoint& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.w * (-wy * xy - wz * xz) + b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.w * (wx * xy - wz * yz) - b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.w * (wx * xz + wy * yz) + b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = b.w * (xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Motor Bivector::sandwich(const Quaternion& b) const noexcept {
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (xyMxy + xzMxz + yzMyz),
            .wx = 2.0 * (b.xy * (wxMxy + wzMyz) + b.xz * (wxMxz - wyMyz) + b.yz * (wxMyz + wyMxz - wzMxy)),
            .wy = 2.0 * (b.xy * (wyMxy - wzMxz) + b.xz * (wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz - wxMxz)),
            .wz = 2.0 * (b.xy * (wyMxz + wzMxy - wxMyz) + b.xz * (wzMxz - wyMxy) + b.yz * (wxMxy + wzMyz)),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz)),
            .i = 2.0 * b.s * (wyMxz - wxMyz - wzMxy)
        };
    }

    constexpr Motor Bivector::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz)),
            .xy = 0.0,
            .xz = 0.0,
            .yz = 0.0,
            .i = 2.0 * b.s * (wy * xz - wx * yz - wz * xy)
        };
    }

    constexpr Motor Bivector::sandwich(const Translator& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = (xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz)),
            .xy = 0.0,
            .xz = 0.0,
            .yz = 0.0,
            .i = 2.0 * (wy * xz - wx * yz - wz * xy)
        };
    }

    constexpr Vector Bivector::sandwich(const Vector& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr ProjectivePoint Bivector::sandwich(const Point& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz - wy * xy - wz * xz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (wx * xy - b.x * xzMyz - b.z * xyMxz - wz * yz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz + wx * xz + wy * yz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = (xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Plane Bivector::sandwich(const PlaneIdeal& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = 2.0 * (b.x * (-wy * xy - wz * xz) + b.y * (wx * xy - wz * yz) + b.z * (wx * xz + wy * yz))
        };
    }

    constexpr Bivector Bivector::sandwich(const BivectorBulk& b) const noexcept {
        const double wxMxy = wx * xy;
        const double wxMxz = wx * xz;
        const double wxMyz = wx * yz;
        const double wyMxy = wy * xy;
        const double wyMxz = wy * xz;
        const double wyMyz = wy * yz;
        const double wzMxy = wz * xy;
        const double wzMxz = wz * xz;
        const double wzMyz = wz * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = 2.0 * (b.xy * (wxMxy + wzMyz) + b.xz * (wxMxz - wyMyz) + b.yz * (wxMyz + wyMxz - wzMxy)),
            .wy = 2.0 * (b.xy * (wyMxy - wzMxz) + b.xz * (wxMyz + wyMxz + wzMxy) + b.yz * (wyMyz - wxMxz)),
            .wz = 2.0 * (b.xy * (wyMxz + wzMxy - wxMyz) + b.xz * (wzMxz - wyMxy) + b.yz * (wxMxy + wzMyz)),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr BivectorWeight Bivector::sandwich(const BivectorWeight& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr PseudoScalar Bivector::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * (xy * xy + xz * xz + yz * yz)
        };
    }

    constexpr ProjectivePoint Bivector::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 2.0 * (-wy * xy - wz * xz),
            .y = 2.0 * (wx * xy - wz * yz),
            .z = 2.0 * (wx * xz + wy * yz),
            .w = (xy * xy + xz * xz + yz * yz)
        };
    }


    constexpr Motor ProjectivePoint::sandwich(const Motor& b) const noexcept {
        const double xMw = w * x;
        const double yMw = w * y;
        const double zMw = w * z;
        const double wMw = w * w;
        return {
            .s = b.s * wMw,
            .wx = (2.0 * (b.xy * yMw + b.xz * zMw) - b.wx * wMw),
            .wy = (2.0 * (b.yz * zMw - b.xy * xMw) - b.wy * wMw),
            .wz = (2.0 * (-b.xz * xMw - b.yz * yMw) - b.wz * wMw),
            .xy = b.xy * wMw,
            .xz = b.xz * wMw,
            .yz = b.yz * wMw,
            .i = -b.i * wMw
        };
    }

    constexpr Plane ProjectivePoint::sandwich(const Plane& b) const noexcept {
        const double wMw = w * w;
        return {
            .x = b.x * wMw,
            .y = b.y * wMw,
            .z = b.z * wMw,
            .w = (-b.w * wMw + 2.0 * w * (-b.x * x - b.y * y - b.z * z))
        };
    }

    constexpr Bivector ProjectivePoint::sandwich(const Bivector& b) const noexcept {
        const double xMw = w * x;
        const double yMw = w * y;
        const double zMw = w * z;
        const double wMw = w * w;
        return {
            .wx = (2.0 * (b.xy * yMw + b.xz * zMw) - b.wx * wMw),
            .wy = (2.0 * (b.yz * zMw - b.xy * xMw) - b.wy * wMw),
            .wz = (2.0 * (-b.xz * xMw - b.yz * yMw) - b.wz * wMw),
            .xy = b.xy * wMw,
            .xz = b.xz * wMw,
            .yz = b.yz * wMw
        };
    }

    constexpr ProjectivePoint ProjectivePoint::sandwich(const ProjectivePoint& b) const noexcept {
        const double wMw = w * w;
        return {
            .x = (-b.x * wMw + 2.0 * b.w * w * x),
            .y = (-b.y * wMw + 2.0 * b.w * w * y),
            .z = (-b.z * wMw + 2.0 * b.w * w * z),
            .w = b.w * wMw
        };
    }

    constexpr Motor ProjectivePoint::sandwich(const Quaternion& b) const noexcept {
        const double xMw = w * x;
        const double yMw = w * y;
        const double zMw = w * z;
        const double wMw = w * w;
        return {
            .s = b.s * wMw,
            .wx = 2.0 * (b.xy * yMw + b.xz * zMw),
            .wy = 2.0 * (b.yz * zMw - b.xy * xMw),
            .wz = 2.0 * (-b.xz * xMw - b.yz * yMw),
            .xy = b.xy * wMw,
            .xz = b.xz * wMw,
            .yz = b.yz * wMw,
            .i = 0.0
        };
    }

    constexpr ProjectiveTranslator ProjectivePoint::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double wMw = w * w;
        return {
            .s = b.s * wMw,
            .wx = -b.wx * wMw,
            .wy = -b.wy * wMw,
            .wz = -b.wz * wMw
        };
    }

    constexpr ProjectiveTranslator ProjectivePoint::sandwich(const Translator& b) const noexcept {
        const double wMw = w * w;
        return {
            .s = wMw,
            .wx = -b.wx * wMw,
            .wy = -b.wy * wMw,
            .wz = -b.wz * wMw
        };
    }

    constexpr Vector ProjectivePoint::sandwich(const Vector& b) const noexcept {
        const double wMw = w * w;
        return {
            .x = -b.x * wMw,
            .y = -b.y * wMw,
            .z = -b.z * wMw
        };
    }

    constexpr ProjectivePoint ProjectivePoint::sandwich(const Point& b) const noexcept {
        const double wMw = w * w;
        return {
            .x = (-b.x * wMw + 2.0 * w * x),
            .y = (-b.y * wMw + 2.0 * w * y),
            .z = (-b.z * wMw + 2.0 * w * z),
            .w = wMw
        };
    }

    constexpr Plane ProjectivePoint::sandwich(const PlaneIdeal& b) const noexcept {
        const double wMw = w * w;
        return {
            .x = b.x * wMw,
            .y = b.y * wMw,
            .z = b.z * wMw,
            .w = 2.0 * w * (-b.x * x - b.y * y - b.z * z)
        };
    }

    constexpr Bivector ProjectivePoint::sandwich(const BivectorBulk& b) const noexcept {
        const double xMw = w * x;
        const double yMw = w * y;
        const double zMw = w * z;
        const double wMw = w * w;
        return {
            .wx = 2.0 * (b.xy * yMw + b.xz * zMw),
            .wy = 2.0 * (b.yz * zMw - b.xy * xMw),
            .wz = 2.0 * (-b.xz * xMw - b.yz * yMw),
            .xy = b.xy * wMw,
            .xz = b.xz * wMw,
            .yz = b.yz * wMw
        };
    }

    constexpr BivectorWeight ProjectivePoint::sandwich(const BivectorWeight& b) const noexcept {
        const double wMw = w * w;
        return {
            .wx = -b.wx * wMw,
            .wy = -b.wy * wMw,
            .wz = -b.wz * wMw
        };
    }

    constexpr PseudoScalar ProjectivePoint::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = -b.i * w * w
        };
    }

    constexpr ProjectivePoint ProjectivePoint::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 2.0 * w * x,
            .y = 2.0 * w * y,
            .z = 2.0 * w * z,
            .w = w * w
        };
    }


    constexpr Motor Quaternion::sandwich(const Motor& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (sMs + xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz)),
            .i = b.i * (sMs + xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Plane Quaternion::sandwich(const Plane& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = b.w * (sMs + xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Bivector Quaternion::sandwich(const Bivector& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr ProjectivePoint Quaternion::sandwich(const ProjectivePoint& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = b.w * (sMs + xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Quaternion Quaternion::sandwich(const Quaternion& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (sMs + xyMxy + xzMxz + yzMyz),
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr ProjectiveTranslator Quaternion::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (sMs + xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr ProjectiveTranslator Quaternion::sandwich(const Translator& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = (sMs + xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr Vector Quaternion::sandwich(const Vector& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr ProjectivePoint Quaternion::sandwich(const Point& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz)),
            .w = (sMs + xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr PlaneIdeal Quaternion::sandwich(const PlaneIdeal& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.y * (sMxy - xzMyz) + b.z * (sMxz + xyMyz)) + b.x * (sMs + yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (b.x * (-sMxy - xzMyz) + b.z * (sMyz - xyMxz)) + b.y * (sMs + xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * (xyMyz - sMxz) + b.y * (-sMyz - xyMxz)) + b.z * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr BivectorBulk Quaternion::sandwich(const BivectorBulk& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .xy = (2.0 * (b.xz * (sMyz + xyMxz) + b.yz * (xyMyz - sMxz)) + b.xy * (sMs + xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * (xyMxz - sMyz) + b.yz * (sMxy + xzMyz)) + b.xz * (sMs + xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * (sMxz + xyMyz) + b.xz * (xzMyz - sMxy)) + b.yz * (sMs + yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr BivectorWeight Quaternion::sandwich(const BivectorWeight& b) const noexcept {
        const double sMs = s * s;
        const double sMxy = s * xy;
        const double sMxz = s * xz;
        const double sMyz = s * yz;
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wy * (sMxy - xzMyz) + b.wz * (sMxz + xyMyz)) + b.wx * (sMs + yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (b.wx * (-sMxy - xzMyz) + b.wz * (sMyz - xyMxz)) + b.wy * (sMs + xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * (xyMyz - sMxz) + b.wy * (-sMyz - xyMxz)) + b.wz * (sMs + xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr PseudoScalar Quaternion::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * (s * s + xy * xy + xz * xz + yz * yz)
        };
    }

    constexpr ProjectivePoint Quaternion::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 0.0,
            .y = 0.0,
            .z = 0.0,
            .w = (s * s + xy * xy + xz * xz + yz * yz)
        };
    }


    constexpr Motor ProjectiveTranslator::sandwich(const Motor& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        return {
            .s = b.s * sMs,
            .wx = (2.0 * (-b.xy * sMwy - b.xz * sMwz) + b.wx * sMs),
            .wy = (2.0 * (b.xy * sMwx - b.yz * sMwz) + b.wy * sMs),
            .wz = (2.0 * (b.xz * sMwx + b.yz * sMwy) + b.wz * sMs),
            .xy = b.xy * sMs,
            .xz = b.xz * sMs,
            .yz = b.yz * sMs,
            .i = b.i * sMs
        };
    }

    constexpr Plane ProjectiveTranslator::sandwich(const Plane& b) const noexcept {
        const double sMs = s * s;
        return {
            .x = b.x * sMs,
            .y = b.y * sMs,
            .z = b.z * sMs,
            .w = (b.w * sMs + 2.0 * s * (b.x * wx + b.y * wy + b.z * wz))
        };
    }

    constexpr Bivector ProjectiveTranslator::sandwich(const Bivector& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        return {
            .wx = (2.0 * (-b.xy * sMwy - b.xz * sMwz) + b.wx * sMs),
            .wy = (2.0 * (b.xy * sMwx - b.yz * sMwz) + b.wy * sMs),
            .wz = (2.0 * (b.xz * sMwx + b.yz * sMwy) + b.wz * sMs),
            .xy = b.xy * sMs,
            .xz = b.xz * sMs,
            .yz = b.yz * sMs
        };
    }

    constexpr ProjectivePoint ProjectiveTranslator::sandwich(const ProjectivePoint& b) const noexcept {
        const double sMs = s * s;
        return {
            .x = (b.x * sMs - 2.0 * b.w * s * wx),
            .y = (b.y * sMs - 2.0 * b.w * s * wy),
            .z = (b.z * sMs - 2.0 * b.w * s * wz),
            .w = b.w * sMs
        };
    }

    constexpr Motor ProjectiveTranslator::sandwich(const Quaternion& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        return {
            .s = b.s * sMs,
            .wx = 2.0 * (-b.xy * sMwy - b.xz * sMwz),
            .wy = 2.0 * (b.xy * sMwx - b.yz * sMwz),
            .wz = 2.0 * (b.xz * sMwx + b.yz * sMwy),
            .xy = b.xy * sMs,
            .xz = b.xz * sMs,
            .yz = b.yz * sMs,
            .i = 0.0
        };
    }

    constexpr ProjectiveTranslator ProjectiveTranslator::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double sMs = s * s;
        return {
            .s = b.s * sMs,
            .wx = b.wx * sMs,
            .wy = b.wy * sMs,
            .wz = b.wz * sMs
        };
    }

    constexpr ProjectiveTranslator ProjectiveTranslator::sandwich(const Translator& b) const noexcept {
        const double sMs = s * s;
        return {
            .s = sMs,
            .wx = b.wx * sMs,
            .wy = b.wy * sMs,
            .wz = b.wz * sMs
        };
    }

    constexpr Vector ProjectiveTranslator::sandwich(const Vector& b) const noexcept {
        const double sMs = s * s;
        return {
            .x = b.x * sMs,
            .y = b.y * sMs,
            .z = b.z * sMs
        };
    }

    constexpr ProjectivePoint ProjectiveTranslator::sandwich(const Point& b) const noexcept {
        const double sMs = s * s;
        return {
            .x = (b.x * sMs - 2.0 * s * wx),
            .y = (b.y * sMs - 2.0 * s * wy),
            .z = (b.z * sMs - 2.0 * s * wz),
            .w = sMs
        };
    }

    constexpr Plane ProjectiveTranslator::sandwich(const PlaneIdeal& b) const noexcept {
        const double sMs = s * s;
        return {
            .x = b.x * sMs,
            .y = b.y * sMs,
            .z = b.z * sMs,
            .w = 2.0 * s * (b.x * wx + b.y * wy + b.z * wz)
        };
    }

    constexpr Bivector ProjectiveTranslator::sandwich(const BivectorBulk& b) const noexcept {
        const double sMs = s * s;
        const double sMwx = s * wx;
        const double sMwy = s * wy;
        const double sMwz = s * wz;
        return {
            .wx = 2.0 * (-b.xy * sMwy - b.xz * sMwz),
            .wy = 2.0 * (b.xy * sMwx - b.yz * sMwz),
            .wz = 2.0 * (b.xz * sMwx + b.yz * sMwy),
            .xy = b.xy * sMs,
            .xz = b.xz * sMs,
            .yz = b.yz * sMs
        };
    }

    constexpr BivectorWeight ProjectiveTranslator::sandwich(const BivectorWeight& b) const noexcept {
        const double sMs = s * s;
        return {
            .wx = b.wx * sMs,
            .wy = b.wy * sMs,
            .wz = b.wz * sMs
        };
    }

    constexpr PseudoScalar ProjectiveTranslator::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * s * s
        };
    }

    constexpr ProjectivePoint ProjectiveTranslator::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = -2.0 * s * wx,
            .y = -2.0 * s * wy,
            .z = -2.0 * s * wz,
            .w = s * s
        };
    }


    constexpr Motor Translator::sandwich(const Motor& b) const noexcept {
        return {
            .s = b.s,
            .wx = (b.wx - 2.0 * b.xy * wy - 2.0 * b.xz * wz),
            .wy = (b.wy - 2.0 * b.yz * wz + 2.0 * b.xy * wx),
            .wz = (b.wz + 2.0 * b.xz * wx + 2.0 * b.yz * wy),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz,
            .i = b.i
        };
    }

    constexpr Plane Translator::sandwich(const Plane& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z,
            .w = (b.w + 2.0 * b.x * wx + 2.0 * b.y * wy + 2.0 * b.z * wz)
        };
    }

    constexpr Bivector Translator::sandwich(const Bivector& b) const noexcept {
        return {
            .wx = (b.wx - 2.0 * b.xy * wy - 2.0 * b.xz * wz),
            .wy = (b.wy - 2.0 * b.yz * wz + 2.0 * b.xy * wx),
            .wz = (b.wz + 2.0 * b.xz * wx + 2.0 * b.yz * wy),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr ProjectivePoint Translator::sandwich(const ProjectivePoint& b) const noexcept {
        return {
            .x = (b.x - 2.0 * b.w * wx),
            .y = (b.y - 2.0 * b.w * wy),
            .z = (b.z - 2.0 * b.w * wz),
            .w = b.w
        };
    }

    constexpr Motor Translator::sandwich(const Quaternion& b) const noexcept {
        return {
            .s = b.s,
            .wx = 2.0 * (-b.xy * wy - b.xz * wz),
            .wy = 2.0 * (b.xy * wx - b.yz * wz),
            .wz = 2.0 * (b.xz * wx + b.yz * wy),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz,
            .i = 0.0
        };
    }

    constexpr ProjectiveTranslator Translator::sandwich(const ProjectiveTranslator& b) const noexcept {
        return {
            .s = b.s,
            .wx = b.wx,
            .wy = b.wy,
            .wz = b.wz
        };
    }

    constexpr Translator Translator::sandwich(const Translator& b) const noexcept {
        return {
            .wx = b.wx,
            .wy = b.wy,
            .wz = b.wz
        };
    }

    constexpr Vector Translator::sandwich(const Vector& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z
        };
    }

    constexpr Point Translator::sandwich(const Point& b) const noexcept {
        return {
            .x = (b.x - 2.0 * wx),
            .y = (b.y - 2.0 * wy),
            .z = (b.z - 2.0 * wz)
        };
    }

    constexpr Plane Translator::sandwich(const PlaneIdeal& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z,
            .w = 2.0 * (b.x * wx + b.y * wy + b.z * wz)
        };
    }

    constexpr Bivector Translator::sandwich(const BivectorBulk& b) const noexcept {
        return {
            .wx = 2.0 * (-b.xy * wy - b.xz * wz),
            .wy = 2.0 * (b.xy * wx - b.yz * wz),
            .wz = 2.0 * (b.xz * wx + b.yz * wy),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr BivectorWeight Translator::sandwich(const BivectorWeight& b) const noexcept {
        return {
            .wx = b.wx,
            .wy = b.wy,
            .wz = b.wz
        };
    }

    constexpr PseudoScalar Translator::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i
        };
    }

    constexpr Point Translator::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = -2.0 * wx,
            .y = -2.0 * wy,
            .z = -2.0 * wz
        };
    }



    constexpr Motor Point::sandwich(const Motor& b) const noexcept {
        return {
            .s = b.s,
            .wx = (-b.wx + 2.0 * (b.xy * y + b.xz * z)),
            .wy = (-b.wy + 2.0 * (b.yz * z - b.xy * x)),
            .wz = (-b.wz + 2.0 * (-b.xz * x - b.yz * y)),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz,
            .i = -b.i
        };
    }

    constexpr Plane Point::sandwich(const Plane& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z,
            .w = (-b.w + 2.0 * (-b.x * x - b.y * y - b.z * z))
        };
    }

    constexpr Bivector Point::sandwich(const Bivector& b) const noexcept {
        return {
            .wx = (-b.wx + 2.0 * (b.xy * y + b.xz * z)),
            .wy = (-b.wy + 2.0 * (b.yz * z - b.xy * x)),
            .wz = (-b.wz + 2.0 * (-b.xz * x - b.yz * y)),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr ProjectivePoint Point::sandwich(const ProjectivePoint& b) const noexcept {
        return {
            .x = (-b.x + 2.0 * b.w * x),
            .y = (-b.y + 2.0 * b.w * y),
            .z = (-b.z + 2.0 * b.w * z),
            .w = b.w
        };
    }

    constexpr Motor Point::sandwich(const Quaternion& b) const noexcept {
        return {
            .s = b.s,
            .wx = 2.0 * (b.xy * y + b.xz * z),
            .wy = 2.0 * (b.yz * z - b.xy * x),
            .wz = 2.0 * (-b.xz * x - b.yz * y),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz,
            .i = 0.0
        };
    }

    constexpr ProjectiveTranslator Point::sandwich(const ProjectiveTranslator& b) const noexcept {
        return {
            .s = b.s,
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz
        };
    }

    constexpr Translator Point::sandwich(const Translator& b) const noexcept {
        return {
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz
        };
    }

    constexpr Vector Point::sandwich(const Vector& b) const noexcept {
        return {
            .x = -b.x,
            .y = -b.y,
            .z = -b.z
        };
    }

    constexpr Point Point::sandwich(const Point& b) const noexcept {
        return {
            .x = (-b.x + 2.0 * x),
            .y = (-b.y + 2.0 * y),
            .z = (-b.z + 2.0 * z)
        };
    }

    constexpr Plane Point::sandwich(const PlaneIdeal& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z,
            .w = 2.0 * (-b.x * x - b.y * y - b.z * z)
        };
    }

    constexpr Bivector Point::sandwich(const BivectorBulk& b) const noexcept {
        return {
            .wx = 2.0 * (b.xy * y + b.xz * z),
            .wy = 2.0 * (b.yz * z - b.xy * x),
            .wz = 2.0 * (-b.xz * x - b.yz * y),
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr BivectorWeight Point::sandwich(const BivectorWeight& b) const noexcept {
        return {
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz
        };
    }

    constexpr PseudoScalar Point::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = -b.i
        };
    }

    constexpr Point Point::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 2.0 * x,
            .y = 2.0 * y,
            .z = 2.0 * z
        };
    }


    constexpr Motor PlaneIdeal::sandwich(const Motor& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .s = b.s * (xMx + yMy + zMz),
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz)),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz)),
            .i = b.i * (-xMx - yMy - zMz)
        };
    }

    constexpr Plane PlaneIdeal::sandwich(const Plane& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (b.y * xMy + b.z * xMz) + b.x * (xMx - yMy - zMz)),
            .y = (2.0 * (b.x * xMy + b.z * yMz) + b.y * (yMy - xMx - zMz)),
            .z = (2.0 * (b.x * xMz + b.y * yMz) + b.z * (zMz - xMx - yMy)),
            .w = b.w * (-xMx - yMy - zMz)
        };
    }

    constexpr Bivector PlaneIdeal::sandwich(const Bivector& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz)),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz))
        };
    }

    constexpr ProjectivePoint PlaneIdeal::sandwich(const ProjectivePoint& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (-b.y * xMy - b.z * xMz) + b.x * (yMy + zMz - xMx)),
            .y = (2.0 * (-b.x * xMy - b.z * yMz) + b.y * (xMx + zMz - yMy)),
            .z = (2.0 * (-b.x * xMz - b.y * yMz) + b.z * (xMx + yMy - zMz)),
            .w = b.w * (xMx + yMy + zMz)
        };
    }

    constexpr Quaternion PlaneIdeal::sandwich(const Quaternion& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .s = b.s * (xMx + yMy + zMz),
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz))
        };
    }

    constexpr ProjectiveTranslator PlaneIdeal::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .s = b.s * (xMx + yMy + zMz),
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz))
        };
    }

    constexpr ProjectiveTranslator PlaneIdeal::sandwich(const Translator& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .s = (xMx + yMy + zMz),
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz))
        };
    }

    constexpr Vector PlaneIdeal::sandwich(const Vector& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (-b.y * xMy - b.z * xMz) + b.x * (yMy + zMz - xMx)),
            .y = (2.0 * (-b.x * xMy - b.z * yMz) + b.y * (xMx + zMz - yMy)),
            .z = (2.0 * (-b.x * xMz - b.y * yMz) + b.z * (xMx + yMy - zMz))
        };
    }

    constexpr ProjectivePoint PlaneIdeal::sandwich(const Point& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (-b.y * xMy - b.z * xMz) + b.x * (yMy + zMz - xMx)),
            .y = (2.0 * (-b.x * xMy - b.z * yMz) + b.y * (xMx + zMz - yMy)),
            .z = (2.0 * (-b.x * xMz - b.y * yMz) + b.z * (xMx + yMy - zMz)),
            .w = (xMx + yMy + zMz)
        };
    }

    constexpr PlaneIdeal PlaneIdeal::sandwich(const PlaneIdeal& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .x = (2.0 * (b.y * xMy + b.z * xMz) + b.x * (xMx - yMy - zMz)),
            .y = (2.0 * (b.x * xMy + b.z * yMz) + b.y * (yMy - xMx - zMz)),
            .z = (2.0 * (b.x * xMz + b.y * yMz) + b.z * (zMz - xMx - yMy))
        };
    }

    constexpr BivectorBulk PlaneIdeal::sandwich(const BivectorBulk& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .xy = (2.0 * (b.yz * xMz - b.xz * yMz) + b.xy * (zMz - xMx - yMy)),
            .xz = (2.0 * (-b.xy * yMz - b.yz * xMy) + b.xz * (yMy - xMx - zMz)),
            .yz = (2.0 * (b.xy * xMz - b.xz * xMy) + b.yz * (xMx - yMy - zMz))
        };
    }

    constexpr BivectorWeight PlaneIdeal::sandwich(const BivectorWeight& b) const noexcept {
        const double xMx = x * x;
        const double xMy = x * y;
        const double xMz = x * z;
        const double yMy = y * y;
        const double yMz = y * z;
        const double zMz = z * z;
        return {
            .wx = (2.0 * (-b.wy * xMy - b.wz * xMz) + b.wx * (yMy + zMz - xMx)),
            .wy = (2.0 * (-b.wx * xMy - b.wz * yMz) + b.wy * (xMx + zMz - yMy)),
            .wz = (2.0 * (-b.wx * xMz - b.wy * yMz) + b.wz * (xMx + yMy - zMz))
        };
    }

    constexpr PseudoScalar PlaneIdeal::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * (-x * x - y * y - z * z)
        };
    }

    constexpr ProjectivePoint PlaneIdeal::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 0.0,
            .y = 0.0,
            .z = 0.0,
            .w = (x * x + y * y + z * z)
        };
    }


    constexpr Motor BivectorBulk::sandwich(const Motor& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz)),
            .i = b.i * (xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Plane BivectorBulk::sandwich(const Plane& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = b.w * (xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Bivector BivectorBulk::sandwich(const Bivector& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz)),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr ProjectivePoint BivectorBulk::sandwich(const ProjectivePoint& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = b.w * (xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr Quaternion BivectorBulk::sandwich(const Quaternion& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (xyMxy + xzMxz + yzMyz),
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr ProjectiveTranslator BivectorBulk::sandwich(const ProjectiveTranslator& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = b.s * (xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr ProjectiveTranslator BivectorBulk::sandwich(const Translator& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .s = (xyMxy + xzMxz + yzMyz),
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr Vector BivectorBulk::sandwich(const Vector& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr ProjectivePoint BivectorBulk::sandwich(const Point& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz)),
            .w = (xyMxy + xzMxz + yzMyz)
        };
    }

    constexpr PlaneIdeal BivectorBulk::sandwich(const PlaneIdeal& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .x = (2.0 * (b.z * xyMyz - b.y * xzMyz) + b.x * (yzMyz - xyMxy - xzMxz)),
            .y = (2.0 * (-b.x * xzMyz - b.z * xyMxz) + b.y * (xzMxz - xyMxy - yzMyz)),
            .z = (2.0 * (b.x * xyMyz - b.y * xyMxz) + b.z * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr BivectorBulk BivectorBulk::sandwich(const BivectorBulk& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .xy = (2.0 * (b.xz * xyMxz + b.yz * xyMyz) + b.xy * (xyMxy - xzMxz - yzMyz)),
            .xz = (2.0 * (b.xy * xyMxz + b.yz * xzMyz) + b.xz * (xzMxz - xyMxy - yzMyz)),
            .yz = (2.0 * (b.xy * xyMyz + b.xz * xzMyz) + b.yz * (yzMyz - xyMxy - xzMxz))
        };
    }

    constexpr BivectorWeight BivectorBulk::sandwich(const BivectorWeight& b) const noexcept {
        const double xyMxy = xy * xy;
        const double xyMxz = xy * xz;
        const double xyMyz = xy * yz;
        const double xzMxz = xz * xz;
        const double xzMyz = xz * yz;
        const double yzMyz = yz * yz;
        return {
            .wx = (2.0 * (b.wz * xyMyz - b.wy * xzMyz) + b.wx * (yzMyz - xyMxy - xzMxz)),
            .wy = (2.0 * (-b.wx * xzMyz - b.wz * xyMxz) + b.wy * (xzMxz - xyMxy - yzMyz)),
            .wz = (2.0 * (b.wx * xyMyz - b.wy * xyMxz) + b.wz * (xyMxy - xzMxz - yzMyz))
        };
    }

    constexpr PseudoScalar BivectorBulk::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = b.i * (xy * xy + xz * xz + yz * yz)
        };
    }

    constexpr ProjectivePoint BivectorBulk::sandwich(const PointCenter& b) const noexcept {
        return {
            .x = 0.0,
            .y = 0.0,
            .z = 0.0,
            .w = (xy * xy + xz * xz + yz * yz)
        };
    }




    constexpr Motor PointCenter::sandwich(const Motor& b) const noexcept {
        return {
            .s = b.s,
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz,
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz,
            .i = -b.i
        };
    }

    constexpr Plane PointCenter::sandwich(const Plane& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z,
            .w = -b.w
        };
    }

    constexpr Bivector PointCenter::sandwich(const Bivector& b) const noexcept {
        return {
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz,
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr ProjectivePoint PointCenter::sandwich(const ProjectivePoint& b) const noexcept {
        return {
            .x = -b.x,
            .y = -b.y,
            .z = -b.z,
            .w = b.w
        };
    }

    constexpr Quaternion PointCenter::sandwich(const Quaternion& b) const noexcept {
        return {
            .s = b.s,
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr ProjectiveTranslator PointCenter::sandwich(const ProjectiveTranslator& b) const noexcept {
        return {
            .s = b.s,
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz
        };
    }

    constexpr Translator PointCenter::sandwich(const Translator& b) const noexcept {
        return {
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz
        };
    }

    constexpr Vector PointCenter::sandwich(const Vector& b) const noexcept {
        return {
            .x = -b.x,
            .y = -b.y,
            .z = -b.z
        };
    }

    constexpr Point PointCenter::sandwich(const Point& b) const noexcept {
        return {
            .x = -b.x,
            .y = -b.y,
            .z = -b.z
        };
    }

    constexpr PlaneIdeal PointCenter::sandwich(const PlaneIdeal& b) const noexcept {
        return {
            .x = b.x,
            .y = b.y,
            .z = b.z
        };
    }

    constexpr BivectorBulk PointCenter::sandwich(const BivectorBulk& b) const noexcept {
        return {
            .xy = b.xy,
            .xz = b.xz,
            .yz = b.yz
        };
    }

    constexpr BivectorWeight PointCenter::sandwich(const BivectorWeight& b) const noexcept {
        return {
            .wx = -b.wx,
            .wy = -b.wy,
            .wz = -b.wz
        };
    }

    constexpr PseudoScalar PointCenter::sandwich(const PseudoScalar& b) const noexcept {
        return {
            .i = -b.i
        };
    }

    constexpr PointCenter PointCenter::sandwich(const PointCenter& b) const noexcept {
        return {};
    }


}